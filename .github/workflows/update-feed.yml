name: Atualizar Feed RSS

on:
  # Roda a cada hora
  schedule:
    - cron: "0 * * * *"
  # Permite rodar manualmente a partir da aba "Actions" do GitHub
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Baixa o código do seu repositório
      - name: Checkout código
        uses: actions/checkout@v3

      # 2. Configura o ambiente Python
      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' # Pode ajustar para a sua versão

      # 3. Instala as dependências
      - name: Instalar dependências
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. Roda o scraper para gerar o arquivo XML
      - name: Gerar o feed
        run: python scraper.py

      # 5. Faz o commit do novo arquivo XML para o repositório
      - name: Commit do feed gerado
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add feed_tecnoblog.xml
          # A linha abaixo só faz commit se houver mudanças no arquivo
          git diff --quiet --exit-code feed_tecnoblog.xml || git commit -m "Atualiza o feed RSS"
          git push